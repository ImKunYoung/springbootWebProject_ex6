<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>read</title>
</head>

<!--replace-->
<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">

	<!--basic content 에 삽입되는 부분-->
	<th:block th:fragment="content">


		<!--제목-->
		<h1 class="mt-4">Board Read Page</h1>



		<!--게시물 번호-->
		<div class="form-group">
			<label>Bno</label>
			<input type="text" class="form-control" name="gno" th:value="${dto.bno}" readonly>
		</div>

		<!--게시물 제목-->
		<div class="form-group">
			<label>Title</label>
			<input type="text" class="form-control" name="title" th:value="${dto.title}" readonly>
		</div>

		<!--게시물 내용-->
		<div class="form-group">
			<label>Content</label>
			<textarea class="form-control" rows="5" name="content" readonly>[[${dto.content}]]</textarea>
		</div>

		<!--작성자-->
		<div class="form-group">
			<label>Writer</label>
			<input type="text" class="form-control" name="writer" th:value="${dto.writerName}" readonly>
		</div>

		<!--작성일-->
		<div class="form-group">
			<label>RegDate</label>
			<input type="text" class="form-control" name="regDate" th:value="${#temporals.format(dto.regDate, 'yyyy/MM/dd HH:mm:ss')}" readonly>
		</div>

		<!--최종 수정일-->
		<div class="form-group">
			<label>ModDate</label>
			<input type="text" class="form-control" name="modDate" th:value="${#temporals.format(dto.modDate, 'yyyy/MM/dd HH:mm:ss')}" readonly>
		</div>



		<!--수정페이지 이동버튼-->
		<a th:href="@{/board/modify(bno = ${dto.bno}, page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}">
			<button type="button" class="btn btn-primary">Modify</button>
		</a>

		<!--목록페이지 이동버튼-->
		<a th:href="@{/board/list(bno = ${dto.bno}, page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}">
			<button type="button" class="btn btn-info">List</button>
		</a>

		<!--댓글-->
		<div>

			<!--댓글 버튼-->
			<div class="mt-4">

				<!--댓글 추가 버튼-->
				<h5>
					<span class="badge badge-info addReply">Add Reply</span>
				</h5>

				<!--댓글 보기 버튼-->
				<h5>
					<span class="badge badge-secondary replyCount">Reply Count [[${dto.replyCount}]]</span>
				</h5>


			</div>


			<div class="list-group replyList">

			</div>

		</div>


		<!--댓글 보기 버튼 처리-->
		<script th:inline="javascript">
            $(document).ready(() => { // Dom 이 완전히 불러와지면 실행

                const bno = [[${dto.bno}]];

                /*댓글이 추가될 영역*/
                const listGroup = $(".replyList");

                /*날짜 처리를 위한 함수*/
                const formatTime = (str) => {
                    const date = new Date(str);

                    return date.getFullYear() + '/'
                        + (date.getMonth() + 1) + '/'
                        + date.getDate() + ' '
                        + date.getHours() + ':'
                        + date.getMinutes();

                }


                /*특정한 게시글의 댓글을 처리하는 함수*/
                const loadJSONDate = () => {
                    $.getJSON('/replies/board/'+bno, arr => { // https://mkil.tistory.com/357  참고

                        console.log(arr)

                        let str = "";

                        $('.replyCount').html("  Reply Count  "+ arr.length);

                        /*array 반복문*/
                        $.each(arr, (idx, reply) => {
                            console.log("==========="+reply);

                            str +='<div class="card-body" data-rno="' + reply.rno + '">'
                                + '<b>' + reply.rno + '</b>';

                            str +='<h5 class="card-title">' + reply.text + '</h5>';

                            str +='<h6 class="card-subtitle mb-2 text-muted">' + reply.replyer + '</h6>';

                            str +='<p class="card-text">' + formatTime(reply.regDate) + '</p>';

                            str +='</div>';

                        })

                        listGroup.html(str);

                    });

                }


                const Handler_replyCount = () => {
                    loadJSONDate()
                }

                /*전역적으로 돌아가는..*/
                $(".replyCount").click(
                    Handler_replyCount
                ) // end click

            })
		</script>

		<!--댓글 추가 처리-->
		<script th:inline="javascript">
            $(document).ready(() => { // Dom 이 완전히 불러와지면 실행

                /*모달 컴포넌트*/
                const modal = $('.modal');

                /*이벤트 처리*/
                const handle_AddReply = () => {
                    modal.modal('show');
                }

                /*addReply 클릭 시 이벤트 처리 함수 호출*/
                $(".addReply").click(handle_AddReply);

            })
		</script>

		<!--댓글 추가 모달-->
		<div class="modal" tabindex="-1" role="dialog">

			<div class="modal-dialog" role="document">

				<div class="modal-content">

					<div class="modal-header">
						<h5 class="modal-title">Modal Title</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>

					<div class="modal-body">

						<div class="form-group">
							<input class="form-control" type="text" name="replyText" placeholder="Reply Text...">
						</div>

						<div class="form-group">
							<input class="form-control" type="text" name="replyer" placeholder="Replyer">
							<input type="hidden" name="rno">
						</div>

					</div>

					<div class="modal-footer">
						<!--삭제 버튼-->
						<button type="button" class="btn btn-danger replyRemove">Remove</button>
						<!--수정 버튼-->
						<button type="button" class="btn btn-warning replyModify">Modify</button>
						<!--저장 버튼-->
						<button type="button" class="btn btn-primary replySave">Save</button>

						<!--닫기 버튼-->
						<button type="button" class="btn btn-outline-secondary replyClose" data-dismiss="modal">Close</button>
					</div>

				</div>

			</div>

		</div>



	</th:block>

</th:block>

</html>